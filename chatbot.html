<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
  </head>
  <body>
    <div class="js-container"></div>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/Chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
      
      function ChatInput({ chatMassage, setChatMassage }) {
  const [inputText, setInputText] = React.useState("");
  const [isLoading, setIsLoading] = React.useState(false);

  function saveInputText(event) {
    setInputText(event.target.value);
  }

  async function sendMessage() {
    if (isLoading || inputText === "") return;

    setIsLoading(true);
    const text = inputText;   // keep a copy before clearing
    setInputText("");

    const newChatMessages = [
      ...chatMassage,
      {
        message: text,
        sender: "user",
        id: crypto.randomUUID(),
      },
    ];

    setChatMassage([
      ...newChatMessages,
      { message: "Loading...", sender: "robot", id: crypto.randomUUID() },
    ]);

    const response = await Chatbot.getResponseAsync(text);

    setChatMassage([
      ...newChatMessages,
      { message: response, sender: "robot", id: crypto.randomUUID() },
    ]);

    setIsLoading(false);
  }

  function handleKeyDown(event) {
    if (event.key === "Enter") sendMessage();
    else if (event.key === "Escape") setInputText("");
  }

  return (
    <div>
      <input
        type="text"
        placeholder="Type your message..."
        size="50"
        onChange={saveInputText}
        onKeyDown={handleKeyDown}
        value={inputText}
      />
      <button onClick={sendMessage}>Send</button>
    </div>
  );
}

      function ChatMessage(props){
        const {message,sender} = props;     
          return(
            <div>
              {sender==="robot" &&
               (<img src="./pictures/robot.png" width="50"/>) 
              }
              {message}
              {sender==="user" &&
              ( <img src="./pictures/user.png" width="50"/> )
            }
            </div>
          );
       
      }

      function ChatMassage({chatMassage}){
      return(
        <div>
          {chatMassage.map((chat)=>(
            <ChatMessage 
              key={chat.id}
              message={chat.message}
              sender={chat.sender}
            />
          ))}
        </div>
      );
      }

      function App(){
      const [chatMassage,setChatMassage]=React.useState([{
        message:"Hello Chatbot",
        sender:"user",
        id:"id1"},
        {message:"Hello! How can I help you?",
        sender:"robot",
        id:"id2"},
        {message:"Can you get me todays date?",
        sender:"user",
        id:"id3"},
        {message:"Sure! Today is June 10, 2024.",
        sender:"robot",
        id:"id4"},
      ]);
        return(
          <div>
            <ChatInput
              chatMassage={chatMassage}
              setChatMassage={setChatMassage}
            />
            <ChatMassage
              chatMassage={chatMassage}
            />
          </div>
        );
      }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App/>);
    </script>
  </body>
</html>