<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 20px;
      }
      .send-button {
        background-color: rgb(25,135,84);
        color: white;
        border: none;
        padding: 12px 20px;
        margin-left: 10px;
        border-radius: 10px;
        font-size: 15px;
        cursor: pointer;
      }
      .chat-input {
      /* padding: 12px 20px; */
      /* margin: 10px 0; */
      border: 1px solid #a5a3a3;
      border-width: 1px;
      border-radius: 10px;
      font-size: 15px;
      flex-grow: 1;

      }
      .chat-input-container {
        display: flex;
        margin-bottom: 60px;
      }

      .app-container {
       max-width: 600px;
       margin-left: auto;
        margin-right: auto;
       height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .chat-message-user {
        display: flex;
        justify-content: end;
        align-items: start;

      }

      .chat-message-text {
        background-color: rgb(238, 238, 238);
        border-radius: 10px;
        padding: 15px 20px  ;
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 20px;
        max-width: 300px;
        word-wrap: break-word;
      }

      .chat-message-robot {
        display: flex;
        justify-content: start;
        align-items: start;
      }

      .chat-message-profile {
        width: 45px;
        height: 45px;
        border-radius: 50%;
      }
      .chat-massage-container {
        flex-grow: 1;
        margin-top: 20px;
        overflow-y: scroll;

      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/Chatbot.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
      
    function ChatInput({ chatMassage, setChatMassage }) {
      const [inputText, setInputText] = React.useState("");
      const [isLoading, setIsLoading] = React.useState(false);

      function saveInputText(event) {
        setInputText(event.target.value);
      }

      async function sendMessage() {
        if (isLoading || inputText === "") return;

        setIsLoading(true);
        const text = inputText;   // keep a copy before clearing
        setInputText("");

        const newChatMessages = [
         ...chatMassage,
           {
           message: text,
           sender: "user",
           id: crypto.randomUUID(),
           },
        ];

        setChatMassage([
          ...newChatMessages,
         { message: "Loading...", sender: "robot", id: crypto.randomUUID() },
        ]);

        const response = await Chatbot.getResponseAsync(text);

         setChatMassage([
         ...newChatMessages,
         { message: response, sender: "robot", id: crypto.randomUUID() },
       ]);

        setIsLoading(false);
    }

    function handleKeyDown(event) {
     if (event.key === "Enter") sendMessage();
     else if (event.key === "Escape") setInputText("");
    }

    return (
    <div className="chat-input-container">
      <input
        type="text"
        placeholder="Type your message..."
        size="50"
        onChange={saveInputText}
        onKeyDown={handleKeyDown}
        value={inputText}
        className="chat-input"
      />
      <button 
        onClick={sendMessage}
        className="send-button">
        Send</button>
    </div>
  );
}

      function ChatMessage(props){
        const {message,sender} = props;  
          return(
            <div className={
              sender==="user"
              ? "chat-message-user"
              :"chat-message-robot"}>
              {sender==="robot" &&
               (<img src="./pictures/robot.png" className="chat-message-profile"/>) 
              }
              <div className="chat-message-text">
                {message}
              </div>
              {sender==="user" &&
              ( <img src="./pictures/user.png" className="chat-message-profile"/> )
            }
            </div>
          );
       
      }

      function ChatMassage({chatMassage}){
          const chatMessageRef = React.useRef(null);
           React.useEffect(()=>{
            const contaienerElem=chatMessageRef.current;
            if(contaienerElem){
              contaienerElem.scrollTop=contaienerElem.scrollHeight;
             }},[chatMassage]);
      return(
        <div 
        className="chat-massage-container"
        ref={chatMessageRef}>
          {chatMassage.map((chat)=>(
            <ChatMessage 
              key={chat.id}
              message={chat.message}
              sender={chat.sender}
            />
          ))}
        </div>
      );
      }

      function App(){
      const [chatMassage,setChatMassage]=React.useState([{
        message:"Hello Chatbot",
        sender:"user",
        id:"id1"},
        {message:"Hello! How can I help you?",
        sender:"robot",
        id:"id2"},
        {message:"Can you get me todays date?",
        sender:"user",
        id:"id3"},
        {message:"Sure! Today is June 10, 2024.",
        sender:"robot",
        id:"id4"},
      ]);
        return(
          <div className="app-container">
            
            <ChatMassage
              chatMassage={chatMassage}
            />
            <ChatInput
              chatMassage={chatMassage}
              setChatMassage={setChatMassage}
            />
          </div>
        );
      }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App/>);
    </script>
  </body>
</html>